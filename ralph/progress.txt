# Todo Folders System - Progress Log

## Feature Overview
Implement a folder system for the Todo plugin. The main screen shows a list of folders with previews of the last 2 todos. Clicking a folder navigates to the existing todo/tags view, now scoped to that folder.

## Design Decisions
- Navigation: Back button in header (uses existing plugin header customization)
- Tags: Isolated per folder (not global)
- Folder creation: "+" button reveals inline input
- Folder display: Vertical list with preview of 2 most recent todos
- Folder management: Rename, delete, reorder (drag & drop)
- Deletion: Confirmation modal with 5-second countdown on delete button

---

## 2026-01-16 - Task 1: Backend - Create folders table and migrate existing data
- What was implemented:
  - Created `folders` table with columns: id, name, position, created_at
  - Added `folder_id` column to `todos` table with foreign key (ON DELETE CASCADE)
  - Added `folder_id` column to `tags` table with foreign key (ON DELETE CASCADE)
  - Changed tags uniqueness constraint from global to per-folder (UNIQUE(name, folder_id))
  - Created `migrate_to_folders_schema()` function that:
    - Creates a "Default" folder
    - Migrates existing todos and tags to the default folder
    - Uses table recreation pattern (SQLite doesn't support ADD COLUMN with FK easily)
  - Updated `migrate_legacy_json()` to include folder_id when importing from JSON
- Files changed:
  - `src-tauri/src/storage/migrations.rs`
- **Learnings for future iterations:**
  - SQLite doesn't support ALTER TABLE ADD COLUMN with foreign key constraints well - use table recreation pattern
  - Check column existence with `conn.prepare("SELECT col FROM table LIMIT 1").is_ok()`
  - Cargo workspace is in `src-tauri/`, not project root
  - Migration runs on every startup - use `CREATE TABLE IF NOT EXISTS` for idempotency
  - The `execute_batch` function doesn't support parameterized queries - use format! for dynamic values


# Tasks Plugin - PRD Progress

## Overview
- **Total tasks**: 15
- **Completed**: 11
- **In Progress**: 0
- **Remaining**: 4

## Fase 1: Rename "Todo" to "Tasks" (9 tasks)
- [x] 1.1: Backend - Rename todo module to tasks and update types
- [x] 1.2: Backend - Update store and storage with data migration
- [x] 1.3: Backend - Rename commands and update error messages
- [x] 1.4: Backend - Update lib.rs, logging.rs and paths.rs
- [x] 1.5: Frontend - Rename files and update types
- [x] 1.6: Frontend - Update hook (useTasksStorage.ts)
- [x] 1.7: Frontend - Update main component (TasksPlugin.tsx)
- [x] 1.8: Frontend - Update manifest, registry and navigation hook
- [ ] 1.9: Verify Phase 1 - Manual testing of rename

## Fase 2: Implement Subtasks (6 tasks)
- [x] 2.1: Backend - Add Subtask type and update Task struct
- [x] 2.2: Backend - Add subtask commands
- [x] 2.3: Frontend - Add Subtask types and update Task interface
- [x] 2.4: Frontend - Add subtask operations to hook
- [ ] 2.5: Frontend - Add subtask UI components (use frontend-design skill)
- [ ] 2.6: Verify Phase 2 - Manual testing of subtasks

## Notes
- Fase 1 must be completed before starting Fase 2
- Tasks 1.5-1.7 don't commit individually (batch commit at 1.8)
- Tasks 2.5 requires frontend-design skill for UI implementation
- Test tasks (1.9, 2.6) are manual verification steps

---

## 2026-01-21 06:45 - Fase 1.1
- What was implemented: Renamed todo module folder to tasks, updated mod.rs, renamed all types in types.rs (Todo→Task, TodoData→TasksData, TodoWithTags→TaskWithTags, TodoDataResponse→TasksDataResponse, RecentTodo→RecentTask, todo_count→task_count, recent_todos→recent_tasks)
- Files changed:
  - src-tauri/src/plugins/todo/ → src-tauri/src/plugins/tasks/ (folder rename)
  - src-tauri/src/plugins/mod.rs
  - src-tauri/src/plugins/tasks/types.rs
- **Learnings for future iterations:**
  - Patterns discovered: Rust serde uses camelCase for JSON serialization via `#[serde(rename_all = "camelCase")]`
  - Gotchas encountered: The TasksData struct now uses `tasks: Vec<Task>` instead of `todos: Vec<Todo>` - storage.rs and commands.rs need to be updated to use `.tasks` field access
  - Useful context: The backend rename is split into 4 tasks (1.1-1.4) to allow incremental commits; cargo check will fail until all 4 are done

## 2026-01-21 06:47 - Fase 1.2
- What was implemented: Updated mod.rs (TodoStore→TasksStore, init_todo_store()→init_tasks_store(), tracing target to "tasks"), updated storage.rs (get_todo_dir()→get_tasks_dir(), paths to tasks/tasks.json, migration from old todo/todo.json, type references to TasksData/Task)
- Files changed:
  - src-tauri/src/plugins/tasks/mod.rs
  - src-tauri/src/plugins/tasks/storage.rs
- **Learnings for future iterations:**
  - Patterns discovered: Migration logic follows priority order: new JSON → old JSON → SQLite → default. Each migration cleans up old files.
  - Gotchas encountered: The `data.todos` field is now `data.tasks` - commands.rs needs `.tasks` not `.todos` for field access
  - Useful context: Old todo directory is removed after migration using remove_dir_all, with graceful error handling if removal fails

## 2026-01-21 06:50 - Fase 1.3
- What was implemented: Renamed all commands and updated error messages in commands.rs (todo_get_by_folder→tasks_get_by_folder, todo_create→tasks_create, todo_update_status→tasks_update_status, todo_delete→tasks_delete, todo_set_tags→tasks_set_tags), updated all TodoStore→TasksStore references, renamed internal variables (folder_todos→folder_tasks, sorted_todos→sorted_tasks), updated data field access (.todos→.tasks), updated error messages ("Todo not found"→"Task not found")
- Files changed:
  - src-tauri/src/plugins/tasks/commands.rs
- **Learnings for future iterations:**
  - Patterns discovered: Commands follow a consistent pattern: get State<TasksStore>, read/write data, validate, mutate, save_to_json(), return Result
  - Gotchas encountered: The parameter name `todo_id` in tasks_set_tags was renamed to `task_id` for consistency
  - Useful context: cargo check will still fail after this task because lib.rs references the old command names - this is expected until task 1.4 completes

## 2026-01-21 06:53 - Fase 1.4
- What was implemented: Updated lib.rs (plugins::todo→plugins::tasks, command registrations todo_*→tasks_*, init_todo_store()→init_tasks_store(), comment "Todo plugin"→"Tasks plugin"), updated logging.rs (plugins array "todo"→"tasks", all match cases for frontend logging), updated paths.rs test (get_plugin_dir("todo")→get_plugin_dir("tasks"))
- Files changed:
  - src-tauri/src/lib.rs
  - src-tauri/src/core/logging.rs
  - src-tauri/src/shared/paths.rs
- **Learnings for future iterations:**
  - Patterns discovered: Logging routes by target name - the plugins array in init_logging() determines which log file receives events
  - Gotchas encountered: Frontend logging via log_from_frontend uses string matching on plugin name, so both plugins array AND match cases need updating
  - Useful context: Backend rename is NOW COMPLETE - cargo check passes. Frontend still uses old invoke command names as strings (not type-checked), so TypeScript passes but runtime will fail until frontend migration (1.5-1.8) is done

## 2026-01-21 06:55 - Fase 1.5-1.8 (Frontend Rename)
- What was implemented: Complete frontend rename from Todo to Tasks
  - 1.5: Renamed folder src/plugins/todo/ to src/plugins/tasks/, renamed TodoPlugin.tsx to TasksPlugin.tsx, useTodoStorage.ts to useTasksStorage.ts, updated types.ts (TodoStatus→TaskStatus, Todo→Task, RecentTodo→RecentTask, todoCount→taskCount, recentTodos→recentTasks)
  - 1.6: Updated hook - renamed useTodoStorage to useTasksStorage, updated all interfaces (TaskFromBackend, TasksDataFromBackend, UseTasksStorageReturn), updated invoke calls (todo_*→tasks_*), renamed all variables (todos→tasks, setTodos→setTasks), updated toast messages
  - 1.7: Updated main component - renamed TodoPlugin to TasksPlugin, TodoView to TasksView, updated navigation label to "Tasks", renamed all mini-components (TodoPluginItem→TasksPluginItem, etc.), updated all variables and props
  - 1.8: Updated manifest (TodoManifest→TasksManifest, id "todo"→"tasks", name "Todo"→"Tasks"), updated registry.ts imports, updated useNavigationLevels.ts example comment
- Files changed:
  - src/plugins/todo/ → src/plugins/tasks/ (folder rename)
  - src/plugins/tasks/types.ts
  - src/plugins/tasks/useTasksStorage.ts
  - src/plugins/tasks/TasksPlugin.tsx
  - src/plugins/tasks/index.tsx
  - src/plugins/registry.ts
  - src/core/hooks/useNavigationLevels.ts
- **Learnings for future iterations:**
  - Patterns discovered: Frontend components follow NomeDoComponentePrincipal + Parte pattern (e.g., TasksPluginItem, TasksPluginTagBadge)
  - Gotchas encountered: The file was auto-formatted by the editor during edits, so exact string matching for edits required re-reading the file
  - Gotchas encountered: Pre-existing Biome lint warnings about accessibility (onClick without onKeyDown on divs) appeared but are not TypeScript errors
  - Useful context: The frontend rename is batched in a single commit as specified in PRD notes. Both `bun tsc --noEmit` and `cargo check` pass after this change

## 2026-01-21 07:05 - Fase 2.1
- What was implemented: Added Subtask struct with fields (id, text, completed, position), added subtasks field to Task struct with #[serde(default)], added subtasks to TaskWithTags response struct, updated tasks_get_by_folder to include subtasks in response, updated tasks_create to initialize empty subtasks vec, fixed SQLite migration to include subtasks field
- Files changed:
  - src-tauri/src/plugins/tasks/types.rs
  - src-tauri/src/plugins/tasks/commands.rs
  - src-tauri/src/plugins/tasks/storage.rs
- **Learnings for future iterations:**
  - Patterns discovered: Adding new fields to Task requires updating 3 places: types.rs (Task struct + TaskWithTags), commands.rs (create + get responses), storage.rs (SQLite migration)
  - Gotchas encountered: SQLite migration constructs Task manually with default empty values for new fields (subtasks: Vec::new()) since old database has no subtasks column
  - Useful context: The #[serde(default)] attribute ensures backward compatibility - existing tasks.json without subtasks field will deserialize with empty vec

## 2026-01-21 07:12 - Fase 2.2
- What was implemented: Added 5 subtask commands (subtasks_create, subtasks_toggle, subtasks_delete, subtasks_reorder, subtasks_update_text), updated tasks_update_status to cascade completion to subtasks when parent task is marked completed, registered all commands in lib.rs
- Files changed:
  - src-tauri/src/plugins/tasks/commands.rs (added 5 new command functions + updated tasks_update_status)
  - src-tauri/src/lib.rs (registered 5 new commands)
- **Learnings for future iterations:**
  - Patterns discovered: Commands follow State<TasksStore> → find task → mutate → save_to_json() → return Result pattern consistently
  - Gotchas encountered: subtasks_toggle returns the new boolean state (not void) to allow frontend to optimistically update without re-querying
  - Useful context: Position calculation for new subtasks follows same max+1 pattern as folders - ensures new items appear at end of list

## 2026-01-21 07:08 - Fase 2.3
- What was implemented: Added frontend Subtask interface with id, text, completed, position fields, added subtasks field to Task interface, added SubtaskFromBackend interface to hook, created mapBackendSubtask function, updated mapBackendTask to include subtasks mapping, added subtasks: [] to optimistic task creation
- Files changed:
  - src/plugins/tasks/types.ts (added Subtask interface, added subtasks to Task)
  - src/plugins/tasks/useTasksStorage.ts (added SubtaskFromBackend, mapBackendSubtask, updated mapBackendTask, updated optimistic createTask)
- **Learnings for future iterations:**
  - Patterns discovered: Frontend type mapping follows pattern: XFromBackend interface → mapBackendX function → X interface from types.ts
  - Gotchas encountered: When adding new fields to Task interface, must also update optimistic task creation in createTask callback (line 174)
  - Useful context: The Subtask import was added but mapBackendSubtask creates the Subtask object directly, so the import is used for type annotation

## 2026-01-21 07:10 - Fase 2.4
- What was implemented: Added 5 subtask operations to useTasksStorage hook (createSubtask, toggleSubtask, deleteSubtask, reorderSubtasks, updateSubtaskText), updated UseTasksStorageReturn interface with all new function signatures, added all functions to return object
- Files changed:
  - src/plugins/tasks/useTasksStorage.ts (added 5 subtask operation functions, updated interface and return object)
- **Learnings for future iterations:**
  - Patterns discovered: All optimistic update operations follow the same pattern: capture previousTasks, setTasks() to optimistically update, try invoke() then catch and rollback with setTasks(previousTasks)
  - Gotchas encountered: createSubtask needs access to `tasks` state to calculate maxPosition, so it has `[tasks]` in dependency array unlike other operations that use `[]`
  - Useful context: Subtask operations target nested state (task.subtasks), so all setTasks() calls use nested .map() to find the right task then modify its subtasks array

# Task Detail View - Progress

## Current Status
Task 3 of 10 completed

## Tasks
- [x] 1. Backend - Add tasks_update_text command
- [x] 2. Frontend Hook - Add updateTaskText function
- [x] 3. State and Navigation - Add task detail view infrastructure
- [ ] 4. Modify TasksPluginItem - Remove inline subtasks, add click navigation
- [ ] 5. Create TasksPluginTaskDetail component - Layout structure
- [ ] 6. TasksPluginTaskDetail - Task info section with inline editing
- [ ] 7. TasksPluginTaskDetail - Subtasks section with input on top
- [ ] 8. TasksPluginSubtaskItem - Add inline text editing
- [ ] 9. Wire up TasksPluginTaskDetail in main component
- [ ] 10. Verify implementation - Manual testing

## Notes
- Tasks 5, 6, 8 should use the frontend-design skill
- No borders between sections, use headers as separators
- Edit icons always aligned to the right
- Subtask input at the top of the list
- Delete task returns to list automatically

---

## 2026-01-21 12:24 - Task 1: Backend - Add tasks_update_text command
- Implemented `tasks_update_text` Tauri command in `commands.rs`
- Validates empty text, finds task by id, updates text, saves to JSON
- Registered command in `lib.rs` invoke_handler
- **Files changed:**
  - `src-tauri/src/plugins/tasks/commands.rs` - Added new command
  - `src-tauri/src/lib.rs` - Registered command
- **Learnings for future iterations:**
  - Pattern for update commands: validate input → get write lock → find entity → update field → save_to_json
  - `subtasks_update_text` already exists (different from `tasks_update_text`) - naming is plural for the resource, singular action

## 2026-01-21 12:26 - Task 2: Frontend Hook - Add updateTaskText function
- Added `updateTaskText` to `UseTasksStorageReturn` interface
- Implemented `updateTaskText(id, text)` with optimistic update pattern: store previous state → update state → invoke backend → rollback on error
- Added to return object
- **Files changed:**
  - `src/plugins/tasks/useTasksStorage.ts` - Added interface entry, implementation, and return value
- **Learnings for future iterations:**
  - Optimistic update pattern in this hook: capture `previousTasks` inside `setTasks` callback, invoke backend, rollback on catch
  - Interface order matches return object order for consistency
  - Backend command uses snake_case (`tasks_update_text`), frontend uses camelCase (`updateTaskText`)

## 2026-01-21 12:27 - Task 3: State and Navigation - Add task detail view infrastructure
- Expanded `TasksView` type to include `'task'`
- Added `currentTaskId` state and derived `currentTask` from tasks array
- Added `handleNavigateToTask(taskId)` and `handleNavigateToList()` navigation handlers
- Updated `useNavigationLevels` with third level for task detail (shows truncated task text)
- Added `onNavigate` callback to folder level to return to list view
- Moved `useNavigationLevels` call after `currentTask` derivation for proper dependency ordering
- **Files changed:**
  - `src/plugins/tasks/TasksPlugin.tsx` - Added view type, state, handlers, navigation levels
- **Learnings for future iterations:**
  - `useNavigationLevels` must be called after all derived state it depends on is defined
  - Use `void` statement to satisfy `noUnusedLocals` for infrastructure functions that will be wired up in later tasks
  - Navigation levels pattern: `[root, parent && {}, child && {}]` - falsy values are filtered out
  - Task text truncation: `text.length > 20 ? `${text.slice(0, 20)}...` : text` for breadcrumb display

## Codebase Patterns
- Use bun as the package manager
- TypeScript strict mode is enabled
- Project uses Tauri v2 with React + TypeScript
- Tailwind CSS v4 uses Vite plugin instead of PostCSS config
- shadcn/ui components are in src/components/ui/
- Path alias @/ maps to ./src/ (configured in tsconfig.json and vite.config.ts)
- Dark theme is set via class="dark" on HTML element
- System tray logic is in src-tauri/src/tray.rs (setup_tray + handle_run_event)
- To keep app in background on close: intercept CloseRequested event and call api.prevent_close()
- Tauri Position/Size are enums (Physical/Logical variants) - pattern match to extract values
- Window configuration goes in tauri.conf.json app.windows array
- Plugin data storage in src-tauri/src/storage.rs: read_plugin_data/write_plugin_data commands save to ~/.local/share/jubby/{plugin_id}.json
- Use usePluginStorage<T>(pluginId, defaultValue) hook for plugin persistence - returns { data, setData, isLoading }

---

## 2026-01-12 - US-001
- What was implemented:
  - Initialized Tauri v2 project with React + TypeScript template
  - Configured TypeScript with strict mode (already enabled by default)
  - Renamed project from tauri-init to jubby in Cargo.toml, main.rs, and tauri.conf.json
  - Set up bun and installed dependencies
  - Verified cargo build and bun tsc --noEmit pass
- Files changed:
  - Created all project files from Tauri template
  - Modified: src-tauri/Cargo.toml (renamed package)
  - Modified: src-tauri/src/main.rs (updated lib reference)
  - Modified: src-tauri/tauri.conf.json (updated productName, identifier, title)
  - Modified: .gitignore (added Tauri, Claude Code, and Ralph patterns)
- **Learnings for future iterations:**
  - The Tauri template creates a .git folder inside src-tauri that needs to be removed when using a parent git repo
  - bun tauri dev first run downloads and compiles ~500 Rust crates, which takes several minutes
  - TypeScript strict mode is enabled by default in the React + TypeScript template
---

## 2026-01-12 - US-002
- What was implemented:
  - Installed Tailwind CSS v4 with @tailwindcss/vite plugin
  - Initialized shadcn/ui with zinc color scheme
  - Set dark theme as default by adding class="dark" to HTML element
  - Added Button component from shadcn/ui
  - Configured path aliases (@/) in both tsconfig.json and vite.config.ts
  - Updated App.tsx to use Tailwind classes and shadcn Button
  - Removed old App.css in favor of Tailwind-based styling
- Files changed:
  - Modified: index.html (added dark class, updated title)
  - Modified: package.json (added tailwindcss, shadcn dependencies)
  - Modified: vite.config.ts (added tailwind plugin, path alias)
  - Modified: tsconfig.json (added path aliases)
  - Created: src/index.css (Tailwind and shadcn CSS variables)
  - Created: src/components/ui/button.tsx (shadcn Button)
  - Created: src/lib/utils.ts (cn utility function)
  - Created: components.json (shadcn config)
  - Modified: src/App.tsx (use Tailwind classes, shadcn Button)
  - Modified: src/main.tsx (import index.css)
  - Deleted: src/App.css
- **Learnings for future iterations:**
  - Tailwind CSS v4 uses @tailwindcss/vite plugin instead of PostCSS configuration
  - shadcn init --defaults uses New York style and zinc colors automatically
  - The cn() utility from src/lib/utils.ts is essential for merging Tailwind classes
  - Dark theme requires class="dark" on HTML element (not body)
---

## 2026-01-12 - US-003
- What was implemented:
  - Created src/core/ folder with subfolders: components/, hooks/, context/
  - Created src/plugins/ folder with registry.ts (typed plugin array)
  - Created src/shared/ folder with subfolders: components/, lib/
  - Created src/core/types.ts with PluginManifest interface
  - Added .gitkeep files to preserve empty directories in git
- Files changed:
  - Created: src/core/types.ts (PluginManifest interface)
  - Created: src/plugins/registry.ts (empty plugins array)
  - Created: src/core/components/.gitkeep
  - Created: src/core/hooks/.gitkeep
  - Created: src/core/context/.gitkeep
  - Created: src/shared/components/.gitkeep
  - Created: src/shared/lib/.gitkeep
- **Learnings for future iterations:**
  - Use .gitkeep files to preserve empty folders in git
  - PluginManifest interface uses ComponentType from React for the component field
  - The @/ path alias works correctly for imports between new folders
---

## 2026-01-12 - US-004
- What was implemented:
  - Added tray-icon and image-png features to Tauri in Cargo.toml
  - Created src-tauri/src/tray.rs with system tray logic
  - System tray icon appears when app starts (uses default window icon)
  - Clicking tray icon toggles window visibility (show/hide)
  - Closing window hides it instead of exiting (app runs in background)
  - Updated lib.rs to use tray module with setup and run event handlers
- Files changed:
  - Modified: src-tauri/Cargo.toml (added tray-icon, image-png features)
  - Modified: src-tauri/Cargo.lock (new dependencies)
  - Created: src-tauri/src/tray.rs (tray setup and event handlers)
  - Modified: src-tauri/src/lib.rs (added tray module, setup, run handler)
- **Learnings for future iterations:**
  - Tauri v2 requires `tray-icon` feature in Cargo.toml for system tray
  - Use `image-png` feature to enable Image::from_bytes for PNG icons
  - Use app.default_window_icon() to get icon from tauri.conf.json bundle
  - To keep app running in background: intercept WindowEvent::CloseRequested and call api.prevent_close()
  - Use .build() instead of .run() when you need to handle custom run events
  - The window label "main" is the default for the first window in tauri.conf.json
---

## 2026-01-12 - US-005
- What was implemented:
  - Configured window as popover (400x350px, no decorations, starts hidden)
  - Window positioned near tray icon when clicked (centered horizontally)
  - Smart positioning: shows below tray if at top, above if at bottom
  - Toggle behavior: click to show, click again to hide
  - Window always on top and skipped from taskbar
- Files changed:
  - Modified: src-tauri/tauri.conf.json (window config: size, decorations, visible, skipTaskbar, alwaysOnTop)
  - Modified: src-tauri/src/tray.rs (added positioning logic using TrayIconEvent.rect)
- **Learnings for future iterations:**
  - Tauri v2 Position and Size are enums with Physical/Logical variants - must pattern match
  - TrayIconEvent::Click provides `rect` with tray icon position/size and `position` with click coords
  - Use PhysicalPosition for window.set_position()
  - Window config properties: decorations, resizable, visible, skipTaskbar, alwaysOnTop
  - Note: TrayIconEvent may not fire on all Linux desktop environments
---

## 2026-01-12 - US-006
- What was implemented:
  - Popover closes when it loses focus (clicking outside)
  - Added WindowEvent::Focused handler in handle_run_event
  - When focused becomes false, window is hidden automatically
- Files changed:
  - Modified: src-tauri/src/tray.rs (added Focused event handling in match block)
- **Learnings for future iterations:**
  - WindowEvent::Focused(bool) fires when window gains/loses focus
  - Use match block to handle multiple WindowEvent variants cleanly
  - Focus loss is triggered by clicking outside or switching to another window
---

## 2026-01-12 - US-007
- What was implemented:
  - Created PluginGrid component that renders plugins from registry as cards
  - Each card displays plugin icon (emoji) and name
  - Grid uses 3 columns with consistent spacing
  - Added shadcn Card component for styling
  - Created placeholder plugin to test the grid
  - Shows friendly message when no plugins available
  - Updated App.tsx to render PluginGrid as main content
- Files changed:
  - Created: src/core/components/PluginGrid.tsx (grid component)
  - Created: src/components/ui/card.tsx (shadcn Card component)
  - Created: src/plugins/placeholder/index.tsx (test plugin)
  - Modified: src/plugins/registry.ts (added placeholder plugin)
  - Modified: src/App.tsx (replaced demo content with PluginGrid)
  - Deleted: src/core/components/.gitkeep (no longer needed)
- **Learnings for future iterations:**
  - Use `bunx shadcn@latest add card --yes` to add shadcn components non-interactively
  - PluginGrid accepts onPluginClick prop for navigation (to be used in US-010)
  - Card hover effect: `hover:bg-accent` provides good visual feedback
---

## 2026-01-12 - US-008
- What was implemented:
  - Added WindowType type for window variants ('popover' | 'overlay' | 'window')
  - Added PluginCapabilities interface with optional fields: canCreateWindow, requiresOverlay, nativeFeatures
  - Extended PluginManifest interface with optional capabilities field
  - All types properly exported from src/core/types.ts
- Files changed:
  - Modified: src/core/types.ts (added WindowType, PluginCapabilities, extended PluginManifest)
- **Learnings for future iterations:**
  - Keep capabilities optional to maintain backward compatibility with existing plugins
  - nativeFeatures is a string array to allow flexible feature declarations
  - This prepares the architecture for advanced plugins without requiring changes to existing plugins
---

## 2026-01-12 - US-009
- What was implemented:
  - Verified that registry already exists with all required functionality
  - Registry was created in US-007 when implementing the PluginGrid
  - All acceptance criteria already met:
    - src/plugins/registry.ts exports typed PluginManifest array
    - Array contains placeholder plugin (satisfies "empty or with placeholder")
    - Import/export properly typed with TypeScript
    - Typecheck passes
- Files changed:
  - None (already implemented)
- **Learnings for future iterations:**
  - Check if previous user stories already implemented required functionality
  - US-007 (PluginGrid) implicitly created the registry with a placeholder plugin
---

## 2026-01-12 - US-010
- What was implemented:
  - Navigation from grid to plugin view using React useState
  - App.tsx manages activePlugin state (PluginManifest | null)
  - When activePlugin is set, renders the plugin's component
  - When null, shows the PluginGrid
  - PluginGrid already had onPluginClick prop ready (from US-007)
- Files changed:
  - Modified: src/App.tsx (added navigation state and conditional rendering)
- **Learnings for future iterations:**
  - Simple navigation can be done with useState in App.tsx - no need for context
  - Rendering dynamic component: `<activePlugin.component />` works when component is stored as ComponentType
  - US-007 was forward-thinking: PluginGrid's onPluginClick prop anticipated this navigation need
---

## 2026-01-12 - US-011
- What was implemented:
  - Created PluginHeader component with back button (‚Üê) and plugin name
  - Header displayed when inside a plugin view
  - Back button returns to the plugin grid using setActivePlugin(null)
  - Plugin content wrapped in scrollable container (flex-1 overflow-auto)
- Files changed:
  - Created: src/core/components/PluginHeader.tsx (header with back button)
  - Modified: src/App.tsx (added PluginHeader when activePlugin is set)
- **Learnings for future iterations:**
  - shadcn Button size="icon-sm" is perfect for icon-only buttons in headers
  - Using variant="ghost" provides subtle hover feedback without heavy visuals
  - Wrap plugin content in overflow-auto container to handle plugins with scrollable content
---

## 2026-01-12 - US-012
- What was implemented:
  - Created src-tauri/src/storage.rs module with read/write commands
  - read_plugin_data(plugin_id) returns JSON string or null if file doesn't exist
  - write_plugin_data(plugin_id, data) saves JSON to ~/.local/share/jubby/{plugin_id}.json
  - Directory is created automatically if it doesn't exist
  - Removed unused greet command from lib.rs
  - Registered storage commands in invoke_handler
- Files changed:
  - Created: src-tauri/src/storage.rs (storage module with IPC commands)
  - Modified: src-tauri/src/lib.rs (added storage module, registered commands)
- **Learnings for future iterations:**
  - Use std::env::var("HOME") to get home directory in Rust
  - PathBuf::join() is chainable for building paths
  - fs::read_to_string().ok() returns Option<String> - perfect for nullable returns
  - fs::create_dir_all() creates all parent directories as needed
  - Tauri commands return Result<T, String> for error handling
---

## 2026-01-12 - US-013
- What was implemented:
  - Created usePluginStorage<T>(pluginId, defaultValue) hook in src/core/hooks/
  - Hook returns { data, setData, isLoading }
  - Loads data from Rust storage on mount using invoke('read_plugin_data')
  - setData accepts value or updater function (like useState)
  - Automatically saves to Rust storage when setData is called
  - Uses @tauri-apps/api/core for Tauri IPC invocations
- Files changed:
  - Created: src/core/hooks/usePluginStorage.ts (the hook implementation)
  - Deleted: src/core/hooks/.gitkeep (no longer needed)
- **Learnings for future iterations:**
  - Tauri v2 uses `import { invoke } from '@tauri-apps/api/core'` (not '@tauri-apps/api')
  - invoke<T>() is generic - can specify expected return type
  - Rust snake_case command names are used as-is in invoke (read_plugin_data, not readPluginData)
  - Command parameters use camelCase in JavaScript (pluginId matches Rust plugin_id)
---

## 2026-01-12 - US-014
- What was implemented:
  - Created src/plugins/todo/ folder with plugin structure
  - Created types.ts with Todo interface (id, text, completed, createdAt) and TodoStorage interface
  - Created index.tsx with TodoManifest and placeholder TodoApp component
  - Registered TodoManifest in src/plugins/registry.ts (first in array to show first in grid)
- Files changed:
  - Created: src/plugins/todo/types.ts (Todo and TodoStorage interfaces)
  - Created: src/plugins/todo/index.tsx (TodoManifest and TodoApp component)
  - Modified: src/plugins/registry.ts (imported and added TodoManifest)
- **Learnings for future iterations:**
  - Follow existing plugin pattern: types.ts for interfaces, index.tsx for manifest + component
  - Use timestamp (number) for createdAt to enable easy sorting
  - Plugin order in registry.ts array determines grid display order
---

## 2026-01-12 - US-015
- What was implemented:
  - TodoApp now renders list of todos from usePluginStorage hook
  - Todos sorted by createdAt descending (most recent first)
  - Each todo displays checkbox and text
  - Completed todos have line-through and muted text styling
  - Empty state shows friendly message "No tasks yet. Add your first task!"
  - Loading state while fetching data from storage
  - Added shadcn Checkbox component for todo items
- Files changed:
  - Modified: src/plugins/todo/index.tsx (implemented TodoApp and TodoItem components)
  - Created: src/components/ui/checkbox.tsx (shadcn Checkbox component)
- **Learnings for future iterations:**
  - Use `bunx shadcn@latest add <component> --yes` for non-interactive shadcn installs
  - Sort with `.sort((a, b) => b.createdAt - a.createdAt)` for most recent first
  - disabled prop on Checkbox prevents interaction (useful for read-only state until US-017)
---

## 2026-01-12 - US-016
- What was implemented:
  - Added Input field for adding new tasks to TodoApp
  - Enter key handler adds task to list and clears input
  - Uses crypto.randomUUID() for unique task IDs
  - Tasks persist automatically via setData from usePluginStorage
  - Added shadcn Input component
  - Refactored empty state to show input field with helpful message
- Files changed:
  - Modified: src/plugins/todo/index.tsx (added useState, Input, handleKeyDown)
  - Created: src/components/ui/input.tsx (shadcn Input component)
- **Learnings for future iterations:**
  - crypto.randomUUID() is available in modern browsers for generating unique IDs
  - setData((prev) => ...) pattern allows functional updates to storage data
  - Keep input always visible (not just in empty state) for better UX
---

## 2026-01-12 - US-017
- What was implemented:
  - Enabled checkbox toggle to mark tasks as completed/uncompleted
  - Added handleToggle function that updates todo completed state via setData
  - Removed disabled prop from Checkbox and added onCheckedChange handler
  - TodoItem now receives onToggle callback prop
  - Changes persist automatically via usePluginStorage
- Files changed:
  - Modified: src/plugins/todo/index.tsx (added handleToggle, updated TodoItem props)
- **Learnings for future iterations:**
  - shadcn Checkbox uses onCheckedChange (not onChange) for toggle events
  - Functional update pattern setData((prev) => ...) works well for modifying items in array
  - Simple toggle: map over array and flip completed for matching id
---

## 2026-01-12 - US-018
- What was implemented:
  - Added delete button with two-click confirmation pattern
  - First click shows checkmark icon (confirmation state), second click deletes
  - Clicking elsewhere cancels confirmation state via parent onClick handler
  - Used pendingDeleteId state to track which item is pending deletion
  - Delete button shows trash icon by default, checkmark when pending
  - Added stopPropagation on TodoItem and Input to prevent unwanted cancellation
  - Inline SVG icons for trash and checkmark (no external dependency needed)
- Files changed:
  - Modified: src/plugins/todo/index.tsx (added delete functionality with confirmation)
- **Learnings for future iterations:**
  - Two-click delete pattern: use state to track pending ID, compare on click
  - Use stopPropagation to prevent parent click handlers from triggering on child elements
  - Inline SVGs work well for simple icons to avoid adding icon library dependencies
  - shadcn Button size="icon" with custom h-6 w-6 gives a smaller icon button
---

## 2026-01-12 - US-019
- What was implemented:
  - Added smooth transitions (150ms duration) to all interactive elements
  - Plugin grid cards now have hover:bg-accent and active:scale-95 feedback
  - PluginHeader back button has active:scale-90 press feedback
  - TodoItem has hover:bg-accent/50 highlight effect
  - Delete button scales up (scale-110) when in confirmation state
  - Custom scrollbar styling for dark theme (6px width, subtle colors)
  - Fixed scroll container for todo list to handle many items
  - Input field has focus:ring-2 effect for better visibility
  - Label text is now selectable with cursor-pointer for better UX
- Files changed:
  - Modified: src/index.css (added custom scrollbar styles, transition utility)
  - Modified: src/core/components/PluginGrid.tsx (added transition and active states)
  - Modified: src/core/components/PluginHeader.tsx (added shrink-0 and transition)
  - Modified: src/plugins/todo/index.tsx (restructured layout for scrolling, added transitions)
- **Learnings for future iterations:**
  - Use consistent transition timing: `transition-all duration-150 ease-out` across the app
  - active:scale-* provides good tactile feedback for buttons
  - Custom scrollbars via ::-webkit-scrollbar work well in Tauri webview
  - Use shrink-0 on fixed elements and flex-1 overflow-y-auto on scrollable containers
  - hover:bg-accent/50 provides subtle highlight without being too aggressive
---

## 2026-01-12 - US-020
- What was implemented:
  - Fixed beforeBuildCommand in tauri.conf.json from "bun build" to "bun run build"
  - Successfully built production executable with bun tauri build
  - Generated binary (13MB), .deb package (4.2MB), and .rpm package
  - Verified executable starts and shows tray icon correctly
- Files changed:
  - Modified: src-tauri/tauri.conf.json (fixed beforeBuildCommand)
- **Learnings for future iterations:**
  - Use `bun run <script>` to run npm scripts, `bun <file>` is for direct file execution
  - Tauri build creates binary at src-tauri/target/release/<app_name>
  - Tauri bundles are created in src-tauri/target/release/bundle/{deb,rpm,appimage}
  - AppImage bundling may fail due to linuxdeploy issues, but binary/deb/rpm still work
  - Production binary size is significantly smaller than development build
---

## 2026-01-12 - US-001 (v2 PRD - Launcher Style)
- What was implemented:
  - Removed menu-based tray approach in favor of direct window open on left click
  - Changed from show_menu_on_left_click(true) with menu to on_tray_icon_event handler
  - Left click now shows window directly without any menu
  - Right click is completely ignored (no action)
  - Added passes fields to all user stories in prd.json for tracking
- Files changed:
  - Modified: src-tauri/src/tray.rs (removed menu, added on_tray_icon_event with MouseButton::Left handling)
  - Modified: ralph/prd.json (added passes field to all 15 user stories)
- **Learnings for future iterations:**
  - TrayIconEvent::Click has button (Left/Right/Middle) and button_state (Up/Down) fields
  - Use MouseButtonState::Up to trigger on button release (feels more natural)
  - Pattern matching with if let TrayIconEvent::Click { button: MouseButton::Left, ... } = event for specific click handling
  - Previous PRD progress.txt entries are from v1; this is a new PRD (v2 Launcher Style) that changes the UX from popover to centered launcher
---

## 2026-01-12 - US-002 (v2 PRD - Launcher Style)
- What was implemented:
  - Added toggle behavior to tray icon click: shows window if hidden, hides if visible
  - Used window.is_visible().unwrap_or(false) to check current visibility state
  - If visible: hide(). If hidden: show() + set_focus()
- Files changed:
  - Modified: src-tauri/src/tray.rs (added toggle logic in on_tray_icon_event)
- **Learnings for future iterations:**
  - window.is_visible() returns Result<bool> in Tauri v2 - use unwrap_or(false) for safe default
  - Toggle pattern: check visibility first, then show() or hide() based on state
---

## 2026-01-12 - US-003 (v2 PRD - Launcher Style)
- What was implemented:
  - Updated window size from 400x350 to 600x400 in tauri.conf.json
  - Added window centering logic in tray.rs before showing the window
  - Centering uses primary_monitor() to get screen dimensions and calculates center position
  - Window settings already had: decorations=false, skipTaskbar=true, alwaysOnTop=true
- Files changed:
  - Modified: src-tauri/tauri.conf.json (changed width to 600, height to 400)
  - Modified: src-tauri/src/tray.rs (added centering logic using PhysicalPosition)
- **Learnings for future iterations:**
  - window.primary_monitor() returns Result<Option<Monitor>> - use .ok().flatten() for safe access
  - Monitor provides size() and position() for calculating center position
  - window.outer_size() gives the actual window dimensions including any borders
  - Use PhysicalPosition::new(x, y) to set window position with i32 coordinates
---

## 2026-01-12 - US-004 (v2 PRD - Launcher Style)
- What was implemented:
  - Verified that close-on-blur functionality was already implemented in v1 PRD (US-006)
  - WindowEvent::Focused(focused) handler in handle_run_event already hides window when focus is lost
  - Cargo build passes without errors
- Files changed:
  - None (already implemented in src-tauri/src/tray.rs lines 76-83)
- **Learnings for future iterations:**
  - Check if functionality from v1 PRD already satisfies v2 PRD requirements
  - Focus loss event in Tauri v2 fires reliably on Linux desktop environments
---

## 2026-01-12 - US-005 (v2 PRD - Launcher Style)
- What was implemented:
  - Added global keydown listener in App.tsx to close window on ESC
  - Uses getCurrentWindow().hide() from @tauri-apps/api/window
  - Added core:window:allow-hide permission to capabilities/default.json
  - ESC works from any view (grid or plugin) and even with focus in inputs
- Files changed:
  - Modified: src/App.tsx (added useEffect with keydown listener for ESC)
  - Modified: src-tauri/capabilities/default.json (added window:allow-hide permission)
- **Learnings for future iterations:**
  - Tauri v2 window API uses getCurrentWindow() from '@tauri-apps/api/window'
  - Window operations need explicit permissions in capabilities (core:window:allow-hide)
  - Global window.addEventListener('keydown') catches keys from all elements including inputs
  - The Todo plugin's onKeyDown only handles Enter, so ESC bubbles up to the global handler
---

## 2026-01-12 - US-006 (v2 PRD - Launcher Style)
- What was implemented:
  - Added arrow key navigation to PluginGrid component
  - Arrow keys (Left/Right/Up/Down) move selection between cards
  - Enter key opens the selected plugin
  - Visual indicator: selected card has ring-2 ring-primary ring-offset-2
  - Wrap navigation: moving past last goes to first, moving before first goes to last
  - Uses modulo arithmetic for wrap: (index + delta + total) % total
  - Grid uses 3 columns, ArrowUp/Down skip by 3 for vertical navigation
- Files changed:
  - Modified: src/core/components/PluginGrid.tsx (added keyboard navigation with useState, useCallback, useEffect)
- **Learnings for future iterations:**
  - Use useCallback for event handlers that depend on state to avoid stale closures
  - Modulo with addition handles negative indices: (index - step + total) % total
  - ring-offset-background matches the current background color for proper ring offset appearance
  - Multiple keydown listeners (ESC in App.tsx, arrows in PluginGrid) can coexist without conflict
---

## 2026-01-12 - US-007 (v2 PRD - Launcher Style)
- What was implemented:
  - Updated .dark CSS variables in src/index.css to match Raycast-inspired theme
  - Background: #0a0a0a (deep black)
  - Text primary (foreground): rgba(255, 255, 255, 0.95)
  - Text secondary (muted-foreground): rgba(255, 255, 255, 0.6)
  - Borders: rgba(255, 255, 255, 0.08)
  - Updated all related variables (card, popover, accent, muted, input, ring, sidebar)
- Files changed:
  - Modified: src/index.css (updated .dark CSS variables block)
- **Learnings for future iterations:**
  - shadcn/ui uses CSS custom properties that map to Tailwind variables via @theme inline
  - Changing --background, --foreground, --border etc. propagates to all shadcn components
  - rgba() values work well alongside hex values in CSS variables
  - PRD color spec rgba(255,255,255,0.08) maps to --border for subtle borders
---

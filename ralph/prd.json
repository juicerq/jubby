[
  {
    "category": "functional",
    "description": "Add recorder_toggle() function with event emission",
    "steps": [
      "Create toggle_recording() function in recorder/commands.rs",
      "Check RecorderState.is_recording to determine action",
      "Call start_recording_internal() or stop_recording_internal() accordingly",
      "Emit 'quickclip:recording-started' or 'quickclip:recording-stopped' events",
      "Wrap in error handler that shows system notification on failure"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "Read existing start_recording_internal and stop_recording_internal functions first. Use tauri::Notification for error feedback."
  },
  {
    "category": "functional",
    "description": "Add shortcut conflict validation",
    "steps": [
      "Create validate_shortcut_unique() function in core/settings.rs",
      "Check new shortcut doesn't match window toggle shortcut",
      "Return descriptive error if conflict detected",
      "Integrate validation in both window and quickclip shortcut update flows"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "Read core/settings.rs to understand existing shortcut management pattern."
  },
  {
    "category": "functional",
    "description": "Register QuickClip shortcut at app startup",
    "steps": [
      "Load QuickClipUserSettings in lib.rs setup() hook",
      "Parse the hotkey string to Shortcut object",
      "Register global shortcut handler that calls toggle_recording on release",
      "Store current QuickClip shortcut in app state for runtime updates"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "Follow the existing pattern used for window toggle shortcut registration in lib.rs lines 115-137."
  },
  {
    "category": "functional",
    "description": "Create recording tray icon asset",
    "steps": [
      "Create tray-icon-recording.png based on existing tray-icon.png",
      "Add red dot indicator to signify recording state",
      "Place in src-tauri/icons/ directory"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "Keep same dimensions as existing tray icon. Red dot should be visible but not overwhelming."
  },
  {
    "category": "functional",
    "description": "Implement tray recording indicator with event listeners",
    "steps": [
      "Add setup_recording_listener() function in core/tray.rs",
      "Listen for 'quickclip:recording-started' and 'quickclip:recording-stopped' events",
      "Create set_tray_recording(bool) function to swap tray icon",
      "Call setup_recording_listener() during app initialization"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "Read core/tray.rs to understand existing tray setup. Use app.listen() for event handling."
  },
  {
    "category": "functional",
    "description": "Add quickclip_update_hotkey command with runtime re-registration",
    "steps": [
      "Create quickclip_update_hotkey Tauri command in persistence.rs",
      "Validate new hotkey doesn't conflict with window shortcut",
      "Save updated hotkey to quickclip.json",
      "Unregister old global shortcut",
      "Register new global shortcut",
      "Update stored shortcut state"
    ],
    "shouldCommit": true,
    "passes": true,
    "notes": "Follow pattern from update_global_shortcut() in core/settings.rs for runtime shortcut changes."
  },
  {
    "category": "functional",
    "description": "Enable shortcuts section in QuickClipSettings.tsx",
    "steps": [
      "Remove disabled state and 'Coming soon' message from shortcuts section",
      "Import and use existing ShortcutInput component",
      "Wire onChange to call quickclip_update_hotkey command",
      "Display current hotkey value from settings"
    ],
    "shouldCommit": true,
    "passes": true,
    "notes": "Reuse the ShortcutInput component from shared/components. Check useQuickClipSettings.ts for settings hook usage. Use frontend-design skill if UI adjustments needed."
  },
  {
    "category": "functional",
    "description": "Expose hotkey in useQuickClipSettings hook",
    "steps": [
      "Add hotkey to returned settings object",
      "Add setHotkey function that calls quickclip_update_hotkey",
      "Handle loading and error states for hotkey updates"
    ],
    "shouldCommit": true,
    "passes": true,
    "notes": "Read useQuickClipSettings.ts - hotkey field already exists in QuickClipUserSettings type."
  },
  {
    "category": "test",
    "description": "Test global shortcut recording flow",
    "steps": [
      "Test shortcut starts recording when window is closed",
      "Test shortcut stops recording when window is closed",
      "Test tray icon changes to recording state on start",
      "Test tray icon reverts to normal on stop",
      "Test error notification appears on failure"
    ],
    "shouldCommit": false,
    "passes": false,
    "notes": "Manual testing required - close the Jubby window and use the configured shortcut."
  },
  {
    "category": "test",
    "description": "Test shortcut customization",
    "steps": [
      "Test changing shortcut in QuickClip settings UI",
      "Test new shortcut works immediately without restart",
      "Test conflict validation rejects duplicate of window shortcut",
      "Test shortcut persists after app restart"
    ],
    "shouldCommit": false,
    "passes": false,
    "notes": "Manual testing required for shortcut input and validation."
  },
  {
    "category": "test",
    "description": "Test frontend sync during recording",
    "steps": [
      "Start recording via global shortcut with window closed",
      "Open Jubby and navigate to QuickClip",
      "Verify UI shows recording in progress",
      "Stop recording via UI button",
      "Verify recording saves correctly"
    ],
    "shouldCommit": false,
    "passes": false,
    "notes": "Ensures frontend correctly syncs with backend recording state on mount."
  }
]

[
  {
    "category": "functional",
    "description": "Add PipeWire dependencies to Cargo.toml",
    "steps": [
      "Add ashpd crate with pipewire feature",
      "Add pipewire crate",
      "Run cargo check to verify dependencies resolve"
    ],
    "shouldCommit": true,
    "passes": true,
    "notes": "Check ashpd docs for correct version and feature flags."
  },
  {
    "category": "functional",
    "description": "Add new error variants to RecorderError",
    "steps": [
      "Add PortalUnavailable variant",
      "Add UserCancelled variant",
      "Add PipeWireError variant"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "Keep existing error variants, just add new ones."
  },
  {
    "category": "functional",
    "description": "Create pipewire_capture module with portal integration",
    "steps": [
      "Create src-tauri/src/pipewire_capture.rs",
      "Implement portal session creation with ashpd",
      "Implement source selection (monitor vs area mode)",
      "Add comprehensive logging at each step"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "Use tracing with target 'quickclip' and [CAPTURE] prefix for logs."
  },
  {
    "category": "functional",
    "description": "Implement PipeWire stream frame capture",
    "steps": [
      "Connect to PipeWire using fd from portal",
      "Set up stream with frame callback",
      "Convert frames to RGBA format",
      "Store frames in Vec<Vec<u8>> buffer",
      "Log frame timing for debugging"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "Handle DMA-BUF and SHM buffer types. Log every 30th frame to avoid spam."
  },
  {
    "category": "functional",
    "description": "Refactor recorder.rs to use pipewire_capture",
    "steps": [
      "Remove xcap import and usage",
      "Update start_recording_internal to use pipewire_capture",
      "Update stop_recording_internal to get frames from pipewire_capture",
      "Keep FFmpeg encoding unchanged"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "RecordingSession struct may need updates. Keep existing encode flow."
  },
  {
    "category": "functional",
    "description": "Update frontend with capture mode buttons",
    "steps": [
      "Replace single record button with Fullscreen/Area options",
      "Pass captureMode to recorder_start command",
      "Handle UserCancelled gracefully (no error toast)"
    ],
    "shouldCommit": true,
    "passes": false,
    "notes": "Use frontend-design skill if UI changes are significant."
  },
  {
    "category": "test",
    "description": "Manual verification of PipeWire capture",
    "steps": [
      "Run bun tauri dev",
      "Test Fullscreen capture - verify 60fps in logs",
      "Test Area capture - verify region selection works",
      "Check output video plays smoothly",
      "Verify all log points appear correctly"
    ],
    "shouldCommit": false,
    "passes": false,
    "notes": "Compare frame timing logs with xcap version (~3fps vs ~60fps)."
  }
]
